<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>Ø´Ø§Øª Ù…Ø¹Ø§Ø° Ø§Ù„Ù…Ù„ÙƒÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  * { box-sizing:border-box; user-select:none; }
  body, html { margin:0;padding:0;height:100%;font-family:'Cairo',sans-serif;direction:rtl;
    background:url('https://i.pinimg.com/736x/50/fd/2b/50fd2b409692dfa636129a6f1eca342b.jpg')center/cover fixed; }
  .chat{display:flex;flex-direction:column;height:100%;background:rgba(0,0,0,0.5);position:relative;}
  .top-bar{padding:10px;background:rgba(0,0,0,0.6);display:flex;justify-content:flex-end;}
  .top-bar button{background:#28a745;color:#fff;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;}
  .messages{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:8px;}
  .msg{max-width:70%;padding:8px 12px;border-radius:10px;position:relative;word-wrap:break-word;font-size:14px;}
  .msg .username{font-size:12px;color:#ccc;margin-bottom:4px;}
  .msg .meta{font-size:11px;color:#aaa;margin-top:4px;text-align:left;}
  .own{align-self:flex-end;background:#007bff;color:#fff;text-align:right;}
  .other{align-self:flex-start;background:#333;color:#fff;text-align:right;}
  .input-area{display:flex;padding:10px;background:rgba(0,0,0,0.7);position:sticky;bottom:0;}
  .input-area input{flex:1;padding:8px;border-radius:8px;border:none;font-size:14px;}
  .input-area button{margin-right:10px;padding:8px 16px;border:none;border-radius:8px;background:#ff6600;color:#fff;cursor:pointer;}
  .menu{position:absolute;background:#222;border:1px solid #444;border-radius:8px;display:none;flex-direction:column;z-index:99;}
  .menu button{background:none;border:none;color:#fff;padding:6px 12px;font-size:13px;text-align:right;cursor:pointer;}
  .menu button:hover{background:#444;}
</style>
</head>
<body>

<div class="chat">
  <div class="top-bar">
    <button onclick="changeName()">ğŸ“ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…</button>
  </div>
  <div id="messages" class="messages"></div>
  <div class="input-area">
    <input id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù…Ø­ØªØ±Ù…Ø©..." onkeydown="if(event.key==='Enter') sendMessage()" />
    <button onclick="sendMessage()">ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>
<div id="contextMenu" class="menu"></div>

<script>
let username = localStorage.getItem("chatUser") || prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
if(!username) username = "Ù…Ø¬Ù‡ÙˆÙ„";
localStorage.setItem("chatUser", username);

let isAdmin = localStorage.getItem("chatAdmin") === "true";
const banned = JSON.parse(localStorage.getItem("chatBanned")||"[]");
const msgsKey="chatMessages";

function load(){return JSON.parse(localStorage.getItem(msgsKey)||"[]")}
function save(a){localStorage.setItem(msgsKey,JSON.stringify(a))}
function saveAdmin(){localStorage.setItem("chatAdmin", isAdmin?"true":"false")}
function saveBanned(){localStorage.setItem("chatBanned",JSON.stringify(banned))}
function now(){return new Date().toLocaleTimeString('ar-EG',{hour:'2-digit',minute:'2-digit'})}

function render(){
  const cont=document.getElementById("messages");
  cont.innerHTML="";
  load().forEach((m,i)=>{
    const div=document.createElement("div"); 
    div.className="msg "+(m.user===username?"own":"other");
    div.innerHTML=`<div class="username">${m.user}</div>${m.text}<div class="meta">${m.time}</div>`;
    div.addEventListener("contextmenu",e=>{
      e.preventDefault();
      showMenu(e.pageX,e.pageY,i);
    });
    cont.appendChild(div);
  });
  cont.scrollTop=cont.scrollHeight;
}

function sendMessage(){
  const inp=document.getElementById("msgInput");
  const text=inp.value.trim();
  if(!text) return;
  if(banned.includes(username)){alert("ğŸš« Ø£Ù†Øª Ù…Ø­Ø¸ÙˆØ±");return;}
  let arr=load();

  if(text==="oncoon"){
    // Ø­Ø°Ù Ø±Ø³Ø§Ù„ØªÙ‡ ÙÙ‚Ø·
    save(arr); isAdmin=true; saveAdmin(); alert("ğŸš¨ Ø£ØµØ¨Ø­Øª Ø£Ø¯Ù…Ù†!");
    inp.value=""; render(); return;
  }

  arr.push({user:username,text, time:now()});
  save(arr); inp.value=""; render();
}

const menu=document.getElementById("contextMenu");
let menuIndex=null;
function showMenu(x,y,i){
  const m=load()[i];
  const isOwn=m.user===username;
  menuIndex=i;
  let html="";
  if(isAdmin){
    html+=`<button onclick="edit()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>`;
    html+=`<button onclick="del()">ğŸ—‘ï¸ Ø­Ø°Ù</button>`;
    html+=`<button onclick="ban()">ğŸš« Ø­Ø¸Ø±</button>`;
  } else if(isOwn){
    html+=`<button onclick="edit()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>`;
    html+=`<button onclick="del()">ğŸ—‘ï¸ Ø­Ø°Ù</button>`;
  }
  menu.innerHTML=html;
  menu.style.display=html?"flex":"none";
  menu.style.left=x+"px";menu.style.top=y+"px";
}

window.addEventListener("click",()=>menu.style.display="none");

function del(){
  const a=load(); a.splice(menuIndex,1); save(a); render(); menu.style.display="none";
}
function edit(){
  const a=load();
  const t=prompt("âœï¸ Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", a[menuIndex].text);
  if(t){a[menuIndex].text=t;save(a);}
  menu.style.display="none"; render();
}
function ban(){
  const a=load();
  const usr=a[menuIndex].user;
  if(!banned.includes(usr)){banned.push(usr); saveBanned();}
  menu.style.display="none";
}

function changeName(){
  const n=prompt("Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯:",username);
  if(n){username=n;localStorage.setItem("chatUser",n);render();}
}

render();

</script>

</body>
</html>
