<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>Ø´Ø§Øª Ù…Ø¹Ø§Ø° Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  * { box-sizing: border-box; margin:0; padding:0 }
  body, html { width:100%; height:100%; font-family:'Cairo',sans-serif; }
  .login, .chat { display:none; width:100%; height:100%; }
  .login.active, .chat.active { display:flex; }
  .login { justify-content:center; align-items:center; background:#000; }
  .login input, .login button { padding:12px; font-size:16px; border:none; border-radius:8px; }
  .login input { width:60%; margin-right:8px; }
  .chat { flex-direction:column; background:url('https://i.pinimg.com/736x/50/fd/2b/50fd2b409692dfa636129a6f1eca342b.jpg') no-repeat center center fixed; background-size:cover; backdrop-filter:brightness(0.5) blur(2px);}
  .container { flex:1; display:flex; flex-direction:column; background:rgba(0,0,0,0.5); }
  .messages { flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:10px; }
  .msg { align-self:flex-end; background:#007bff; color:#fff; padding:10px 14px; border-radius:14px; max-width:70%; position:relative; word-wrap:break-word; }
  .msg .meta { font-size:11px; color:#ddd; margin-top:4px; }
  .msg .username { font-size:12px; color:#ccc; position:absolute; top:-18px; right:10px; }
  .input-area { display:flex; padding:10px; background:rgba(0,0,0,0.6); }
  .input-area input { flex:1; padding:10px; border-radius:8px; border:none; font-size:15px; }
  .input-area button { padding:10px 16px; border:none; border-radius:8px; background:#28a745; color:#fff; cursor:pointer; }
  .menu { position:absolute; background:#222; border:1px solid #444; border-radius:8px; display:none; flex-direction:column; z-index:99; }
  .menu button { background:none; border:none; color:#fff; padding:6px 12px; font-size:13px; text-align:right; cursor:pointer; }
  .menu button:hover { background:#444; }
</style>
</head>
<body>

<div class="login active">
  <input id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." />
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="chat">
  <div class="container">
    <div id="messages" class="messages"></div>
    <div class="input-area">
      <input id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." onkeydown="if(event.key==='Enter') sendMessage();" />
      <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
  </div>
</div>

<div id="contextMenu" class="menu"></div>

<script>
const loginDiv = document.querySelector('.login'), chatDiv = document.querySelector('.chat');
const nameInput = document.getElementById('nameInput');

let currentUser = localStorage.getItem('chatUser');
let isAdmin = (currentUser === 'Messi911');
let banned = JSON.parse(localStorage.getItem('chatBanned')||'[]');

if(currentUser) activateChat();

function login(){
  const name = nameInput.value.trim();
  if(!name) return;
  currentUser = name;
  localStorage.setItem('chatUser', name);
  isAdmin = (name==='Messi911');
  activateChat();
}

function activateChat(){
  loginDiv.classList.remove('active');
  chatDiv.classList.add('active');
  renderMessages();
}

const messagesDiv = document.getElementById('messages');
const contextMenu = document.getElementById('contextMenu');
let menuTargetIndex = null;

function loadMsgs(){ return JSON.parse(localStorage.getItem('chatMsgs')||'[]') }
function saveMsgs(a){ localStorage.setItem('chatMsgs', JSON.stringify(a)) }
function saveBanned(){ localStorage.setItem('chatBanned', JSON.stringify(banned)) }

function getTime(){ const d=new Date(); return d.toLocaleTimeString('ar-EG',{hour:'2-digit',minute:'2-digit'}) }
function sendMessage(){
  const txt = document.getElementById('msgInput').value.trim();
  if(!txt) return;
  if(banned.includes(currentUser)) return alert('ğŸš« Ø£Ù†Øª Ù…Ø­Ø¸ÙˆØ±!');
  let arr = loadMsgs();
  arr.push({user:currentUser,text:txt,time:getTime()});
  saveMsgs(arr);
  document.getElementById('msgInput').value='';
  renderMessages();
}

function renderMessages(){
  messagesDiv.innerHTML='';
  loadMsgs().forEach((m,i)=>{
    const div=document.createElement('div'); div.className='msg';
    div.innerHTML=`<div class="username">${m.user}</div>${m.text}<div class="meta">${m.time}</div>`;
    div.addEventListener('contextmenu',e=>{e.preventDefault(); showMenu(e.pageX,e.pageY,i)});
    messagesDiv.appendChild(div);
  });
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
}

function showMenu(x,y,i){
  contextMenu.style.display = 'flex';
  contextMenu.style.top = y+'px'; contextMenu.style.left = x+'px';
  menuTargetIndex=i;
  let html= '';
  if(isAdmin){
    html+=`<button onclick="editMsg()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>`;
    html+=`<button onclick="deleteMsg()">ğŸ—‘ï¸ Ø­Ø°Ù</button>`;
    html+=`<button onclick="banUser()">ğŸš« Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>`;
  } else if(currentUser === loadMsgs()[i].user){
    html+=`<button onclick="editMsg()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>`;
    html+=`<button onclick="deleteMsg()">ğŸ—‘ï¸ Ø­Ø°Ù</button>`;
  }
  contextMenu.innerHTML=html;
}

window.addEventListener('click',()=>contextMenu.style.display='none');

function deleteMsg(){
  let arr = loadMsgs(); arr.splice(menuTargetIndex,1);
  saveMsgs(arr); renderMessages(); contextMenu.style.display='none';
}
function editMsg(){
  const newText = prompt('âœï¸ Ø¹Ø¯Ù„ Ø±Ø³Ø§Ù„ØªÙƒ:', loadMsgs()[menuTargetIndex].text);
  if(newText) { let arr=loadMsgs(); arr[menuTargetIndex].text=newText; saveMsgs(arr); renderMessages(); }
  contextMenu.style.display='none';
}
function banUser(){
  const u = loadMsgs()[menuTargetIndex].user;
  if(u===currentUser)return alert('Ù…Ø§ ØªÙ‚Ø¯Ø± ØªØ­Ø¸Ø± Ù†ÙØ³Ùƒ');
  banned.push(u); saveBanned();
  contextMenu.style.display='none';
  renderMessages();
}
</script>

</body>
</html>
