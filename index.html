<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>💬 شات </title>
  <style>
    body { background: #111; color: #eee; font-family: sans-serif; text-align: center; }
    #login, #chat { max-width: 400px; margin: 50px auto; padding: 20px; background: #222; border-radius: 8px; }
    input { padding: 8px; margin: 5px; width: 80%; }
    button { padding: 8px 15px; }
    #messages { max-height: 300px; overflow-y: auto; border: 1px solid #333; padding: 10px; text-align: left; }
    .message { display: flex; align-items: center; margin: 5px 0; }
    .message img { width: 30px; height: 30px; border-radius: 50%; margin-right: 10px; }
  </style>
</head>
<body>
  <div id="login">
    <h2>🪪 سجل دخولك</h2>
    <input id="username" placeholder="اسم المستخدم" /><br>
    <input id="avatar" placeholder="رابط الأفاتار" /><br>
    <button id="loginBtn">دخول</button>
  </div>

  <div id="chat" style="display:none;">
    <h2>💬 الشات المحلي</h2>
    <div id="messages"></div>
    <input id="msgInput" placeholder="اكتب رسالتك..." />
    <button id="sendBtn">إرسال</button>
  </div>

  <script>
    const loginDiv = document.getElementById('login');
    const chatDiv = document.getElementById('chat');
    const usernameInput = document.getElementById('username');
    const avatarInput = document.getElementById('avatar');
    const loginBtn = document.getElementById('loginBtn');
    const msgInput = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');
    const messagesDiv = document.getElementById('messages');

    function saveMessages(msgs) {
      localStorage.setItem('messages', JSON.stringify(msgs));
    }

    function loadMessages() {
      return JSON.parse(localStorage.getItem('messages') || '[]');
    }

    function addMessage(username, avatar, msg) {
      const msgElement = document.createElement('div');
      msgElement.classList.add('message');

      const avatarImg = document.createElement('img');
      avatarImg.src = avatar;
      msgElement.appendChild(avatarImg);

      const text = document.createElement('span');
      text.innerText = `${username}: ${msg}`;
      msgElement.appendChild(text);

      messagesDiv.appendChild(msgElement);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // لو عنده بيانات قديمة
    if (localStorage.getItem('username') && localStorage.getItem('avatar')) {
      loginDiv.style.display = 'none';
      chatDiv.style.display = 'block';

      const oldMsgs = loadMessages();
      oldMsgs.forEach(m => addMessage(m.username, m.avatar, m.msg));
    }

    loginBtn.onclick = () => {
      const username = usernameInput.value.trim() || 'مجهول';
      const avatar = avatarInput.value.trim() || 'https://via.placeholder.com/30';
      localStorage.setItem('username', username);
      localStorage.setItem('avatar', avatar);
      loginDiv.style.display = 'none';
      chatDiv.style.display = 'block';

      const oldMsgs = loadMessages();
      oldMsgs.forEach(m => addMessage(m.username, m.avatar, m.msg));
    };

    sendBtn.onclick = () => {
      const msg = msgInput.value.trim();
      if (msg) {
        const username = localStorage.getItem('username');
        const avatar = localStorage.getItem('avatar');
        addMessage(username, avatar, msg);

        const msgs = loadMessages();
        msgs.push({ username, avatar, msg });
        saveMessages(msgs);

        msgInput.value = '';
      }
    };
  </script>
</body>
</html>
