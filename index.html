<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>ÿ¥ÿßÿ™ VIP ‚Äì ŸÖÿπÿßÿ∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  * {
    box-sizing: border-box;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  body, html {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    font-family:'Cairo',sans-serif;
    direction: rtl;
    background: url('https://i.pinimg.com/736x/50/fd/2b/50fd2b409692dfa636129a6f1eca342b.jpg') no-repeat center center fixed;
    background-size: cover;
  }
  .chat { position:relative; height:100%; display:flex; flex-direction:column; background: rgba(0,0,0,0.4); }
  .messages { flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:10px; }
  .msg {
    align-self:flex-end;
    background:#007bff;
    color:#fff;
    padding:10px 14px;
    border-radius:14px;
    max-width:75%;
    position:relative;
    word-break:break-word;
    text-align:right;
  }
  .msg .meta { font-size:11px; color:#ddd; margin-top:4px; text-align:left; }
  .msg .username { font-size:12px; color:#ccc; position:absolute; top:-18px; right:10px; }
  .input-area {
    position: sticky;
    bottom:0;
    display:flex;
    padding:10px;
    background:rgba(0,0,0,0.7);
    align-items:center;
  }
  .input-area input {
    flex:1;
    padding:10px;
    border-radius:8px;
    border:none;
    font-size:15px;
  }
  .input-area button {
    padding:10px 16px;
    border:none;
    border-radius:8px;
    background:#28a745;
    color:#fff;
    margin-right:10px;
    cursor:pointer;
  }
  .menu {
    position:absolute;
    background:#222;
    border:1px solid #444;
    border-radius:8px;
    display:none;
    flex-direction:column;
    z-index:99;
  }
  .menu button {
    background:none;
    border:none;
    color:#fff;
    padding:6px 12px;
    font-size:13px;
    text-align:right;
    cursor:pointer;
  }
  .menu button:hover { background:#444; }
  .settings-btn {
    position:absolute;
    top:10px;
    left:10px;
    background:#28a745;
    color:#fff;
    border:none;
    padding:6px 10px;
    border-radius:8px;
    cursor:pointer;
    font-size:13px;
    user-select:auto;
  }
</style>
</head>
<body>
<div class="chat">
  <button class="settings-btn" onclick="changeName()">ÿ∫Ÿäÿ± ÿßŸÑÿßÿ≥ŸÖ</button>
  <div id="messages" class="messages"></div>
  <div class="input-area">
    <input id="msgInput" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿ≠ÿ™ÿ±ŸÖÿ©..." onkeydown="if(event.key==='Enter') sendMessage()" />
    <button onclick="sendMessage()">ÿ•ÿ±ÿ≥ÿßŸÑ</button>
  </div>
</div>
<div id="contextMenu" class="menu"></div>

<script>
  const currentUser = localStorage.getItem("chatUser") || prompt("ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ:");
  if (currentUser) localStorage.setItem("chatUser", currentUser);
  const isAdmin = currentUser === 'Messi911';

  const messagesDiv = document.getElementById("messages");
  const menu = document.getElementById("contextMenu");
  let menuTarget = null;

  function load() {
    return JSON.parse(localStorage.getItem("chatMsgs") || "[]");
  }
  function save(a) {
    localStorage.setItem("chatMsgs", JSON.stringify(a));
  }
  function timeNow() {
    const d=new Date();
    return d.toLocaleTimeString('ar-EG',{hour:'2-digit',minute:'2-digit'});
  }

  function render() {
    messagesDiv.innerHTML="";
    load().forEach((m,i)=>{
      const div=document.createElement('div'); div.className='msg';
      div.innerHTML = `<div class="username">${m.user}</div>${m.text}<div class="meta">${m.time}</div>`;
      div.addEventListener('contextmenu', e=>{
        e.preventDefault(); showMenu(e.pageX, e.pageY, i);
      });
      messagesDiv.appendChild(div);
    });
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function sendMessage() {
    const t = document.getElementById("msgInput").value.trim();
    if (!t) return;
    let arr = load();
    arr.push({ user: currentUser, text: t, time: timeNow() });
    save(arr);
    document.getElementById("msgInput").value = "";
    render();
  }

  function showMenu(x,y,i){
    menu.style.display="flex";
    menu.style.left=x+"px"; menu.style.top=y+"px";
    menu.innerHTML="";
    const m = load()[i];
    if (currentUser===m.user || isAdmin) {
      menu.innerHTML += `<button onclick="edit(${i})">‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ</button>`;
      menu.innerHTML += `<button onclick="del(${i})">üóëÔ∏è ÿ≠ÿ∞ŸÅ</button>`;
    }
  }

  function del(i) {
    let arr=load(); arr.splice(i,1); save(arr); render(); menu.style.display="none";
  }
  function edit(i) {
    const arr=load();
    const txt = prompt("ÿπÿØŸëŸÑ ÿ±ÿ≥ÿßŸÑÿ™ŸÉ:", arr[i].text);
    if (txt) { arr[i].text = txt; save(arr); render(); }
    menu.style.display="none";
  }
  window.addEventListener("click",()=>menu.style.display="none");

  function changeName() {
    const nm = prompt("ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖŸÉ ÿßŸÑÿ¨ÿØŸäÿØ:", currentUser);
    if (nm) {
      localStorage.setItem("chatUser", nm);
      location.reload();
    }
  }

  render();
</script>
</body>
</html>
