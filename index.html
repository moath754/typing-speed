<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>اختبر سرعتك</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      text-align: center;
      min-height: 100vh;
      overflow: hidden;
      background: #0d0d1a;
      color: #eee;
    }

    canvas#stars {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
    }

    .container {
      max-width: 700px;
      margin: 60px auto;
      padding: 20px;
      background: rgba(30, 30, 50, 0.8);
      border-radius: 15px;
      box-shadow: 0 0 40px rgba(0,0,0,0.4);
    }

    input[type="text"] {
      padding: 12px;
      font-size: 18px;
      width: 80%;
      margin-bottom: 15px;
      border: 2px solid #888;
      border-radius: 8px;
      background-color: #1e1e2e;
      color: #fff;
    }

    button {
      padding: 12px 25px;
      font-size: 18px;
      background-color: #6c5ce7;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background-color: #a29bfe;
    }

    #sentence {
      font-size: 26px;
      font-weight: bold;
      margin: 25px 0;
    }

    #record {
      position: fixed;
      right: 20px;
      top: 20px;
      background: #ffb700;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      z-index: 2;
    }

    #musicControl {
      position: fixed;
      left: 20px;
      top: 20px;
      background: #6c5ce7;
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      z-index: 2;
    }

    #result {
      font-size: 20px;
      margin-top: 20px;
    }

    #result.error {
      color: red;
      font-weight: bold;
    }

    #speedDisplay, #bestTime {
      font-size: 18px;
      margin-top: 10px;
    }

    /* حقوق "موث" */
    #rightsButton {
      position: fixed;
      bottom: 15px;
      right: 15px;
      background-color: transparent;
      border: none;
      z-index: 2;
    }

    #rightsButton img {
      width: 36px;
      height: 36px;
      filter: drop-shadow(0 0 5px white);
    }
  </style>
</head>
<body>

<canvas id="stars"></canvas>

<div id="record">أعلى سرعة: 0 - 0.00 ثانية</div>
<div id="musicControl" title="كتم/تشغيل الموسيقى">🎵</div>

<button id="rightsButton" title="المطور: موث">
  <img src="https://cdn.iconscout.com/icon/free/png-256/discord-3-569463.png" alt="موث">
</button>

<div class="container" id="loginScreen">
  <h2>مرحبًا!</h2>
  <p>اكتب اسمك نبدأ</p>
  <input type="text" id="playerName" placeholder="اسمك" />
  <br />
  <button onclick="startGame()">يلا نبدأ</button>
</div>

<div class="container" id="gameScreen" style="display:none;">
  <h2 id="welcomeMsg"></h2>
  <div id="sentence">...</div>
  <input type="text" id="userInput" placeholder="اكتب هنا" onkeydown="handleEnter(event)" />
  <br />
  <button onclick="checkInput()">تحقق</button>
  <div id="speedDisplay"></div>
  <div id="bestTime"></div>
  <div id="result"></div>
</div>

<audio id="bgMusic" src="https://c.top4top.io/m_343844pxd1.mp3" loop></audio>

<script>
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let stars = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function createStars(count) {
  stars = [];
  for (let i = 0; i < count; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      radius: Math.random() * 1.5 + 0.5,
      speed: Math.random() * 0.5 + 0.2
    });
  }
}

function drawStars() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#ffffff';
  stars.forEach(star => {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
    ctx.fill();
    star.y += star.speed;
    if (star.y > canvas.height) {
      star.y = 0;
      star.x = Math.random() * canvas.width;
    }
  });
  requestAnimationFrame(drawStars);
}

window.addEventListener('resize', () => {
  resizeCanvas();
  createStars(150);
});

resizeCanvas();
createStars(150);
drawStars();
</script>

<script>
  const sentences = [
    "التركيز سر النجاح", "لا تستسلم بسهولة", "كن قدوة في كل شي تسويه",
    "التعب الآن راحة بعدين", "كل تجربة درس", "ابدأ ولا تنتظر",
    "الصبر طريق الإنجاز", "خل عندك هدف واضح", "التطور يبدأ من نفسك",
    "نظم وقتك تنجح", "عيش اللحظة وركز"
  ];

  let currentSentence = "", startTime = 0, highestSpeed = 0, bestTime = null;
  const loginScreen = document.getElementById("loginScreen");
  const gameScreen = document.getElementById("gameScreen");
  const playerName = document.getElementById("playerName");
  const welcomeMsg = document.getElementById("welcomeMsg");
  const sentence = document.getElementById("sentence");
  const userInput = document.getElementById("userInput");
  const result = document.getElementById("result");
  const record = document.getElementById("record");
  const speedDisplay = document.getElementById("speedDisplay");
  const bestTimeDisplay = document.getElementById("bestTime");
  const music = document.getElementById("bgMusic");
  const musicControl = document.getElementById("musicControl");

  function startGame() {
    const name = playerName.value.trim();
    if (!name) return alert("اكتب اسمك أول");
    welcomeMsg.textContent = `يلا يا ${name}، اكتب بسرعة`;
    loginScreen.style.display = "none";
    gameScreen.style.display = "block";
    record.style.display = "block";
    music.volume = 0.3;
    music.play().catch(() => {
      musicControl.textContent = "🔇";
    });
    nextSentence();
  }

  function nextSentence() {
    currentSentence = sentences[Math.floor(Math.random() * sentences.length)];
    sentence.textContent = currentSentence;
    userInput.value = "";
    result.textContent = "";
    result.classList.remove("error");
    speedDisplay.textContent = "";
    bestTimeDisplay.textContent = "";
    startTime = Date.now();
    userInput.focus();
  }

  function handleEnter(e) {
    if (e.key === "Enter") checkInput();
  }

  function checkInput() {
    const typed = userInput.value.trim();
    const duration = (Date.now() - startTime) / 1000;
    const speed = Math.round((typed.length / duration) * 60);
    if (typed === currentSentence) {
      result.textContent = "تمام!";
      result.classList.remove("error");
      if (speed > highestSpeed) {
        highestSpeed = speed;
        bestTime = duration;
        record.textContent = `أعلى سرعة: ${highestSpeed} - ${bestTime.toFixed(2)} ثانية`;
      }
      speedDisplay.textContent = `سرعتك الآن: ${speed}`;
      bestTimeDisplay.textContent = `أسرع وقت: ${duration.toFixed(2)} ثانية`;
      setTimeout(nextSentence, 800);
    } else {
      result.textContent = "غلط! عدلها";
      result.classList.add("error");
      speedDisplay.textContent = `سرعتك الآن: ${speed}`;
    }
  }

  userInput.addEventListener("input", () => {
    const typedWords = userInput.value.trim().split(" ");
    const sentenceWords = currentSentence.split(" ");
    let colored = "";
    for (let i = 0; i < sentenceWords.length; i++) {
      if (typedWords[i] === undefined) {
        colored += `<span>${sentenceWords[i]}</span> `;
      } else if (typedWords[i] === sentenceWords[i]) {
        colored += `<span style="color:lightgreen;">${sentenceWords[i]}</span> `;
      } else {
        colored += `<span style="color:red;">${sentenceWords[i]}</span> `;
      }
    }
    sentence.innerHTML = colored.trim();
  });

  musicControl.addEventListener("click", () => {
    if (music.paused) {
      music.play();
      musicControl.textContent = "🎵";
    } else {
      music.pause();
      musicControl.textContent = "🔇";
    }
  });
</script>

</body>
</html>
