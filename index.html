<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ’¬ Ø´Ø§Øª ÙÙ„Ø§ÙˆÙŠ Ø£Ø³Ø·ÙˆØ±ÙŠ</title>
  <style>
    body {
      background: url('https://images.unsplash.com/photo-1518791841217-8f162f1e1131') no-repeat center center fixed;
      background-size: cover;
      color: #fff; font-family: sans-serif;
      text-align: center; direction: rtl;
    }
    #overlay {
      background: rgba(0,0,0,0.7); min-height: 100vh; padding: 20px;
    }
    #login, #chat { max-width: 700px; margin: 50px auto; padding: 20px; background: #333; border-radius: 12px; }
    input, select { padding: 10px; margin: 5px; width: 80%; border: none; border-radius: 5px; }
    button { padding: 8px 12px; margin: 5px; border: none; border-radius: 5px; background: #555; color: #fff; cursor: pointer; }
    #messages { max-height: 400px; overflow-y: auto; border: 1px solid #444; padding: 10px; text-align: left; background: #222; border-radius: 5px; }
    .message { display: flex; align-items: center; justify-content: space-between; margin: 8px 0; background: #111; padding: 5px 10px; border-radius: 5px; }
    .content { display: flex; align-items: center; flex: 1; }
    .message img { width: 40px; height: 40px; border-radius: 50%; margin-left: 10px; }
    .controls { display: flex; gap: 5px; }
  </style>
</head>
<body>
  <div id="overlay">
    <div id="login">
      <h2>ğŸªª Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ</h2>
      <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" /><br>
      <label>Ø§Ø®ØªØ± Ø£ÙØ§ØªØ§Ø±Ùƒ:</label><br>
      <input type="file" id="avatarFile" accept="image/*"><br><br>
      <label>Ø§Ø®ØªØ± Ø§Ù„Ø®Ù„ÙÙŠØ©:</label><br>
      <select id="bgSelect">
        <option value="bg1">Ø®Ù„ÙÙŠØ© 1</option>
        <option value="bg2">Ø®Ù„ÙÙŠØ© 2</option>
        <option value="bg3">Ø®Ù„ÙÙŠØ© 3</option>
      </select><br>
      <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="chat" style="display:none;">
      <h2>ğŸ’¬ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ</h2>
      <div id="messages"></div>
      <input id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." />
      <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
      <button id="clearChat">ğŸ—‘ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
    </div>
  </div>

  <script>
    const loginDiv = document.getElementById('login');
    const chatDiv = document.getElementById('chat');
    const usernameInput = document.getElementById('username');
    const avatarFile = document.getElementById('avatarFile');
    const bgSelect = document.getElementById('bgSelect');
    const loginBtn = document.getElementById('loginBtn');
    const msgInput = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');
    const messagesDiv = document.getElementById('messages');
    const clearChatBtn = document.getElementById('clearChat');

    let avatarData = '';

    function saveMessages(msgs) {
      localStorage.setItem('messages', JSON.stringify(msgs));
    }

    function loadMessages() {
      return JSON.parse(localStorage.getItem('messages') || '[]');
    }

    function saveSettings(username, avatar, bg) {
      localStorage.setItem('username', username);
      localStorage.setItem('avatar', avatar);
      localStorage.setItem('background', bg);
    }

    function loadSettings() {
      return {
        username: localStorage.getItem('username') || '',
        avatar: localStorage.getItem('avatar') || '',
        bg: localStorage.getItem('background') || 'bg1'
      };
    }

    function setBackground(bg) {
      let url = '';
      if (bg === 'bg1') url = 'https://images.unsplash.com/photo-1518791841217-8f162f1e1131';
      if (bg === 'bg2') url = 'https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0';
      if (bg === 'bg3') url = 'https://images.unsplash.com/photo-1522199710521-72d69614c702';
      document.body.style.backgroundImage = `url('${url}')`;
    }

    function addMessageElement(msgObj, index) {
      const msgElement = document.createElement('div');
      msgElement.classList.add('message');

      const contentDiv = document.createElement('div');
      contentDiv.classList.add('content');

      const avatarImg = document.createElement('img');
      avatarImg.src = msgObj.avatar;
      contentDiv.appendChild(avatarImg);

      const text = document.createElement('span');
      text.innerText = `${msgObj.username}: ${msgObj.msg}`;
      contentDiv.appendChild(text);

      const controlsDiv = document.createElement('div');
      controlsDiv.classList.add('controls');

      const editBtn = document.createElement('button');
      editBtn.innerText = 'âœï¸';
      editBtn.onclick = () => editMessage(index);

      const deleteBtn = document.createElement('button');
      deleteBtn.innerText = 'âŒ';
      deleteBtn.onclick = () => deleteMessage(index);

      controlsDiv.appendChild(editBtn);
      controlsDiv.appendChild(deleteBtn);

      msgElement.appendChild(contentDiv);
      msgElement.appendChild(controlsDiv);

      messagesDiv.appendChild(msgElement);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function renderMessages() {
      messagesDiv.innerHTML = '';
      const msgs = loadMessages();
      msgs.forEach((msg, index) => addMessageElement(msg, index));
    }

    function sendMessage() {
      const msg = msgInput.value.trim();
      if (msg) {
        const msgs = loadMessages();
        msgs.push({ username: localStorage.getItem('username'), avatar: localStorage.getItem('avatar'), msg });
        saveMessages(msgs);
        renderMessages();
        msgInput.value = '';
      }
    }

    function deleteMessage(index) {
      const msgs = loadMessages();
      msgs.splice(index, 1);
      saveMessages(msgs);
      renderMessages();
    }

    function editMessage(index) {
      const msgs = loadMessages();
      const newMsg = prompt('âœï¸ Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', msgs[index].msg);
      if (newMsg !== null) {
        msgs[index].msg = newMsg;
        saveMessages(msgs);
        renderMessages();
      }
    }

    avatarFile.onchange = (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        avatarData = reader.result;
      };
      if (file) reader.readAsDataURL(file);
    };

    loginBtn.onclick = () => {
      const username = usernameInput.value.trim() || 'Ù…Ø¬Ù‡ÙˆÙ„';
      const avatar = avatarData || 'https://via.placeholder.com/40';
      const bg = bgSelect.value;

      saveSettings(username, avatar, bg);
      setBackground(bg);

      loginDiv.style.display = 'none';
      chatDiv.style.display = 'block';

      renderMessages();
    };

    sendBtn.onclick = sendMessage;

    clearChatBtn.onclick = () => {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ')) {
        localStorage.removeItem('messages');
        renderMessages();
      }
    };

    // Ù„Ùˆ Ø¹Ù†Ø¯Ù‡ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
    const settings = loadSettings();
    if (settings.username && settings.avatar) {
      setBackground(settings.bg);
      loginDiv.style.display = 'none';
      chatDiv.style.display = 'block';
      renderMessages();
    }
  </script>
</body>
</html>
